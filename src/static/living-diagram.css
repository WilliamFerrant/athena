/* ═══ LIVING ORCHESTRATION DIAGRAM ══════════════════════════════════════════
   Hub-and-spoke diagram replacing the Jarvis orbital animation.
   All animations use transform/opacity only (GPU-composited, no layout thrash).
   ═══════════════════════════════════════════════════════════════════════════ */

#livingDiagram {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  /* Inherit bridge-layer visibility from parent */
}

/* ── SVG canvas overlay (lines/flows) ──────────────────────────────────── */
#ldSvg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: visible;
}

/* ── Spoke lines ────────────────────────────────────────────────────────── */
.ld-spoke {
  stroke: var(--border);
  stroke-width: 1;
  fill: none;
  transition: stroke 0.4s, stroke-width 0.4s;
}

.ld-spoke.active {
  stroke: var(--accent);
  stroke-width: 1.5;
}

/* Flow particle along spoke */
.ld-flow {
  r: 3;
  fill: var(--accent);
  opacity: 0;
}

/* ── Node cards ─────────────────────────────────────────────────────────── */
.ld-nodes {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.ld-node {
  position: absolute;
  transform: translate(-50%, -50%);
  width: 120px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 10px 12px;
  font-family: var(--font-mono, 'JetBrains Mono', 'Fira Code', monospace);
  pointer-events: auto;
  transition: border-color 0.3s, box-shadow 0.3s;
  box-sizing: border-box;
}

.ld-node:hover {
  border-color: var(--accent);
}

/* ATHENA hub node — slightly larger */
.ld-node.hub {
  width: 154px;
  border-color: color-mix(in srgb, var(--accent) 40%, var(--border));
  /* Subtle breathing animation */
  animation: ldBreathe 5.5s ease-in-out infinite;
}

@keyframes ldBreathe {
  0%, 100% { transform: translate(-50%, -50%) scale(1.00); box-shadow: none; }
  50%       { transform: translate(-50%, -50%) scale(1.01);
              box-shadow: 0 0 12px color-mix(in srgb, var(--accent) 20%, transparent); }
}

/* Node header row */
.ld-node-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 4px;
  margin-bottom: 6px;
}

.ld-node-name {
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 1.2px;
  color: var(--text-bright);
  text-transform: uppercase;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* State badge */
.ld-badge {
  font-size: 8px;
  font-weight: 700;
  letter-spacing: 0.8px;
  padding: 2px 5px;
  border-radius: 3px;
  text-transform: uppercase;
  white-space: nowrap;
  border: 1px solid currentColor;
  transition: color 0.3s, border-color 0.3s, background 0.3s;
}

.ld-badge.idle       { color: var(--muted); border-color: var(--border); background: transparent; }
.ld-badge.planning   { color: #c8a96e; border-color: #c8a96e; background: rgba(200,169,110,.08); }
.ld-badge.executing  { color: var(--accent); border-color: var(--accent); background: rgba(124,166,196,.10);
                        animation: ldBadgePulse 1.2s ease-in-out infinite; }
.ld-badge.reviewing  { color: #a3c78a; border-color: #a3c78a; background: rgba(163,199,138,.08); }
.ld-badge.waiting    { color: var(--muted); border-color: var(--border); background: transparent; }
.ld-badge.error      { color: var(--red); border-color: var(--red); background: rgba(196,84,84,.10); }
.ld-badge.done       { color: #a3c78a; border-color: #a3c78a; background: rgba(163,199,138,.08); }

@keyframes ldBadgePulse {
  0%, 100% { opacity: 1; }
  50%       { opacity: 0.55; }
}

/* Task sub-text */
.ld-node-task {
  font-size: 9px;
  color: var(--muted);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.3;
  min-height: 12px;
}

/* ── Hub extra info rows ────────────────────────────────────────────────── */
.ld-hub-meta {
  margin-top: 7px;
  padding-top: 7px;
  border-top: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  gap: 3px;
}

.ld-meta-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 4px;
  font-size: 8.5px;
  color: var(--muted);
}

.ld-meta-key {
  text-transform: uppercase;
  letter-spacing: 0.6px;
  flex-shrink: 0;
}

.ld-meta-val {
  color: var(--text);
  text-align: right;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 80px;
}

.ld-meta-val.online  { color: var(--green); }
.ld-meta-val.offline { color: var(--red); }
.ld-meta-val.warn    { color: #c8a96e; }

/* ── Global state indicator on hub ─────────────────────────────────────── */
.ld-global-badge {
  display: inline-block;
  font-size: 8px;
  font-weight: 800;
  letter-spacing: 1px;
  padding: 2px 6px;
  border-radius: 3px;
  text-transform: uppercase;
  margin-top: 4px;
  width: 100%;
  text-align: center;
  transition: background 0.4s, color 0.4s;
}

.ld-global-badge.idle     { background: rgba(138,136,120,.12); color: var(--muted); }
.ld-global-badge.active   { background: rgba(124,166,196,.15); color: var(--accent);
                             animation: ldBadgePulse 2s ease-in-out infinite; }
.ld-global-badge.degraded { background: rgba(200,169,110,.15); color: #c8a96e; }
.ld-global-badge.error    { background: rgba(196,84,84,.15); color: var(--red); }

/* ── Spoke flow animation (CSS keyframe on SVG animateMotion fallback) ── */
/* Used as JS-driven opacity + translate via SMIL animateMotion */
.ld-spoke.outbound { /* hub → agent */ }
.ld-spoke.inbound  { /* agent → hub, reverse gradient */ }
